"use strict";(self["webpackChunkweb_shop"]=self["webpackChunkweb_shop"]||[]).push([[850],{850:function(t,e,s){s.r(e),s.d(e,{default:function(){return G}});var r=s(6252),i=s(3577),o=s(9963);const n=t=>((0,r.dD)("data-v-d3e01024"),t=t(),(0,r.Cn)(),t),a={class:"shopcart"},l={class:"grid"},c={claSs:"shopping-cart"},h={class:"list-item"},p=["src"],u={class:"item-product"},d={class:"item-discount"},g=n((()=>(0,r._)("h2",null,"Giảm giá(%)",-1))),m={class:"item-quantity"},C=n((()=>(0,r._)("h2",null,"Số lượng:",-1))),y={class:"select__num-item"},v=["onClick"],_=["placeholder","onUpdate:modelValue"],I=["onClick"],S=["onClick"],f={class:"order-sumary"},w=n((()=>(0,r._)("h1",null,"Tổng tiền:",-1))),O={class:"total"};function b(t,e,s,n,b,N){return(0,r.wg)(),(0,r.iD)("div",a,[(0,r._)("div",l,[(0,r._)("div",c,[(0,r._)("div",h,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(b.shoppingCart,((t,e)=>((0,r.wg)(),(0,r.iD)("div",{class:"item",key:e},[(0,r._)("img",{src:this.urlbe+"/file/"+t.product.imageEntities[0].imgURL,alt:"",class:"item-img"},null,8,p),(0,r._)("div",u,[(0,r._)("h2",null,(0,i.zw)(t.product.productName),1),(0,r._)("h3",null,"Size: "+(0,i.zw)(t.size),1),(0,r._)("h3",null,(0,i.zw)(N.formatPrice(t.product.price)),1)]),(0,r._)("div",d,[g,(0,r._)("h3",null,(0,i.zw)(t.product.discount),1)]),(0,r._)("div",m,[C,(0,r._)("div",y,[(0,r._)("div",{class:"num-item",onClick:t=>N.setNumItem(e,-1)},"-",8,v),(0,r.wy)((0,r._)("input",{type:"text",class:"input__num-item",placeholder:t.quantity,"onUpdate:modelValue":e=>t.quantity=e},null,8,_),[[o.nr,t.quantity]]),(0,r._)("div",{class:"num-item",onClick:t=>N.setNumItem(e,1)},"+",8,I)])]),(0,r._)("button",{class:"decart",onClick:t=>N.deCart(e)},"x",8,S)])))),128))])]),(0,r._)("div",f,[w,(0,r._)("div",O,[(0,r._)("h1",null,"="+(0,i.zw)(N.formatPrice(b.amount)),1)]),(0,r._)("button",{class:"btn-order",onClick:e[0]||(e[0]=(...t)=>N.sendOrder&&N.sendOrder(...t))},"Đặt hàng")])])])}s(7658);var N=s(6154),k=s(8e3),q=s.n(k),z=s(5016),A=s.n(z),J={data(){return{shoppingCart:[],orderId:0,amount:0,messages:[]}},props:["islogin","isAdmin","urlbe","user","urlGW"],created(){this.connect(),null==JSON.parse(localStorage.getItem("shoppingCart"))||0==JSON.parse(localStorage.getItem("shoppingCart")).length?localStorage.setItem("shoppingCart",JSON.stringify(this.shoppingCart)):(this.shoppingCart=JSON.parse(localStorage.getItem("shoppingCart")),this.shoppingCart.reverse(),console.log(this.shoppingCart.length),this.shoppingCart.forEach((t=>{this.amount+=t.product.price*(100-t.product.discount)/100*t.quantity})))},getAmount(){},methods:{formatPrice(t){return new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(t)},addCart(t){this.shoppingCart.push(t),localStorage.setItem("shoppingCart",JSON.stringify(this.shoppingCart)),console.log(localStorage.getItem("shoppingCart"))},setNumItem(t,e){this.shoppingCart[t].quantity+e>0&&(this.shoppingCart[t].quantity+=e,localStorage.setItem("shoppingCart",JSON.stringify(this.shoppingCart.reverse())),this.shoppingCart.reverse()),console.log(this.shoppingCart[t].quantity+e),this.amount=0,this.shoppingCart.forEach((t=>{this.amount+=t.product.price*(100-t.product.discount)/100*t.quantity}))},deCart(t){this.shoppingCart.splice(t,1),localStorage.setItem("shoppingCart",JSON.stringify(this.shoppingCart.reverse())),this.shoppingCart.reverse(),this.amount=0,this.shoppingCart.forEach((t=>{this.amount+=t.product.price*(100-t.product.discount)/100*t.quantity}))},async sendOrder(){if(this.islogin){this.orderId=await this.createOder(),console.log(this.orderId);for(var t=0;t<this.shoppingCart.length;t++)this.addCartItemOder(this.shoppingCart[t].product.id,this.shoppingCart[t].size,this.shoppingCart[t].quantity),console.log(this.shoppingCart[t].product.id);localStorage.removeItem("shoppingCart"),this.sendMessage("đơn hàng #"+this.orderId),alert("Đặt hàng thành công"),this.$router.push("/user")}else alert("Bạn chưa đăng nhập"),this.$router.push("/login")},async createOder(){try{const t=await N.Z.post(this.urlGW+"/order/create",{headers:{"Access-Control-Allow-Origin":"*",Authorization:"Bearer "+localStorage.getItem("token")}});return t.data.id}catch(t){console.error(t)}},async addCartItemOder(t,e,s){try{const r=await N.Z.post(this.urlGW+"/order/cart/create/"+this.orderId+"?pid="+t,{size:e,quantity:s},{headers:{"Access-Control-Allow-Origin":"*",Authorization:"Bearer "+localStorage.getItem("token")}});return r.data.id}catch(r){console.error(r)}},connect(){var t=new(q())("http://localhost:8085/ws");this.stompClient=A().over(t),this.stompClient.connect({},(()=>{this.stompClient.subscribe("/topic/public",(t=>{this.messages.push(t.body)})),this.stompClient.subscribe("/user/"+this.user.id+"/queue/reply",(t=>{this.messages.push(JSON.parse(t.body).content)}))}))},sendMessage(t){var e={sender:this.user.id,content:t,type:"CHAT",receiver:"1"};this.stompClient.send("/app/chat.sendMessagePrivate",JSON.stringify(e))}}},D=s(3744);const E=(0,D.Z)(J,[["render",b],["__scopeId","data-v-d3e01024"]]);var G=E}}]);
//# sourceMappingURL=850.e8f1e4de.js.map